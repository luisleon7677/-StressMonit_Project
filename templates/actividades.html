{% extends "base.html" %}
{% from "macros.html" import render_table, empty_state %}

{% block content %}
<div class="actividades-container">
  <div class="titulo-principal d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 fw-bold">Lista de Actividades</h1>
    <a href="{{ url_for('crear_actividad_route') }}" class="btn-primary-custom shadow-sm">
      <span class="material-symbols-outlined">add_task</span>
      Agregar actividad
    </a>
  </div>

  {% if actividades %}
  {% call render_table(["ID", "Nombre", "Descripción", "Dificultad", "Acciones"], table_id="tablaActividades") %}
  {% for actividad in actividades %}
  <tr>
    <td><span class="badge bg-light text-dark">{{ actividad[0] }}</span></td>
    <td class="fw-medium">{{ actividad[1] }}</td>
    <td class="text-muted small">{{ actividad[2] }}</td>
    <td>
      {% if actividad[3] == 1.0 %}
      <span class="badge bg-success-subtle text-success px-3">Bajo</span>
      {% elif actividad[3] == 2.0 %}
      <span class="badge bg-warning-subtle text-warning px-3">Medio</span>
      {% elif actividad[3] == 3.0 %}
      <span class="badge bg-danger-subtle text-danger px-3">Alto</span>
      {% endif %}
    </td>
    <td class="text-center acciones-cell">
      <div class="d-flex align-items-center justify-content-center gap-1">
        <a href="{{ url_for('editar_actividad', id=actividad[0]) }}" class="btn-accion-icon btn-accion-editar"
          title="Editar">
          <span class="material-symbols-outlined">edit</span>
        </a>
        <form action="{{ url_for('eliminar_actividad', id=actividad[0]) }}" method="POST" class="d-inline"
          onsubmit="return confirm('¿Eliminar esta actividad?');">
          <button type="submit" class="btn-accion-icon btn-accion-eliminar" title="Eliminar">
            <span class="material-symbols-outlined">delete</span>
          </button>
        </form>
      </div>
    </td>
  </tr>
  {% endfor %}
  {% endcall %}
  {% else %}
  {{ empty_state("No hay actividades registradas aún") }}
  {% endif %}
</div>

<nav class="nav-pagination">
  <ul class="pagination justify-content-center" id="paginacionTabla"></ul>
</nav>

<script>
  const filasPorPagina = 5;
  let paginaActual = 1;

  function paginarTabla() {
    const cuerpo = document.getElementById('tablaBody');
    const filas = Array.from(cuerpo.querySelectorAll('tr'));
    const totalPaginas = Math.ceil(filas.length / filasPorPagina);

    filas.forEach(f => f.style.display = 'none');
    const inicio = (paginaActual - 1) * filasPorPagina;
    filas.slice(inicio, inicio + filasPorPagina)
      .forEach(f => f.style.display = '');

    renderPaginacion(totalPaginas);
  }

  function renderPaginacion(total) {
    const pag = document.getElementById('paginacionTabla');
    pag.innerHTML = '';

    if (total <= 1) return;

    // Botón Anterior
    const liPrev = document.createElement('li');
    liPrev.className = `page-item ${paginaActual === 1 ? 'disabled' : ''}`;
    liPrev.innerHTML = `<button class="page-link page-link-custom">‹</button>`;
    liPrev.onclick = () => { if (paginaActual > 1) { paginaActual--; paginarTabla(); } };
    pag.appendChild(liPrev);

    // Páginas
    let startPage = Math.max(1, paginaActual - 1);
    let endPage = Math.min(total, startPage + 2);
    if (endPage - startPage < 2) startPage = Math.max(1, endPage - 2);

    for (let i = startPage; i <= endPage; i++) {
      const li = document.createElement('li');
      li.className = `page-item ${i === paginaActual ? 'active' : ''}`;
      const btn = document.createElement('button');
      btn.className = 'page-link page-link-custom';
      btn.textContent = i;
      btn.onclick = () => { paginaActual = i; paginarTabla(); };
      li.appendChild(btn);
      pag.appendChild(li);
    }

    // Botón Siguiente
    const liNext = document.createElement('li');
    liNext.className = `page-item ${paginaActual === total ? 'disabled' : ''}`;
    liNext.innerHTML = `<button class="page-link page-link-custom">›</button>`;
    liNext.onclick = () => { if (paginaActual < total) { paginaActual++; paginarTabla(); } };
    pag.appendChild(liNext);
  }

  document.addEventListener('DOMContentLoaded', paginarTabla);
</script>

{% endblock %}